<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* Multimarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*github*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>RELAZIONE</title></head><body><article class="markdown-body"><h1 id="sudoku-grabber">Sudoku Grabber<a class="headerlink" href="#sudoku-grabber" title="Permanent link"></a></h1>
<h2 id="elaborato-per-il-corso-di-analisi-immagini-e-analisi-dati-parte-di-analisi-immagini">Elaborato per il Corso di Analisi Immagini e Analisi Dati - parte di Analisi Immagini<a class="headerlink" href="#elaborato-per-il-corso-di-analisi-immagini-e-analisi-dati-parte-di-analisi-immagini" title="Permanent link"></a></h2>
<h3 id="carlo-emilio-montanari">Carlo Emilio Montanari<a class="headerlink" href="#carlo-emilio-montanari" title="Permanent link"></a></h3>
<h4 id="aa-201718-universita-di-bologna-corso-di-laurea-magistrale-in-applied-physics">a.a. 2017/18, Università di Bologna - Corso di Laurea Magistrale in Applied Physics<a class="headerlink" href="#aa-201718-universita-di-bologna-corso-di-laurea-magistrale-in-applied-physics" title="Permanent link"></a></h4>
<h2 id="scopo-del-progetto">Scopo del progetto<a class="headerlink" href="#scopo-del-progetto" title="Permanent link"></a></h2>
<p>Il presente lavoro si pone come obiettivo l&rsquo;enhancing e la sogliatura di un Sudoku estratto da una fotografia generica, con lo scopo di restituire una serie di 81 immagini binarie quadrate (le 81 celle del Sudoku) contenenti al centro l&rsquo;eventuale cifra della cella (o, se non presente, una cella vuota).</p>
<p>Si desidera che questo output finale sia il più adatto possibile ad una successiva analisi per il riconoscimento della cifra (tale fase sarà argomento della relazione di Analisi Dati).</p>
<h2 id="dipendenze-del-progetto">Dipendenze del progetto<a class="headerlink" href="#dipendenze-del-progetto" title="Permanent link"></a></h2>
<p>Il progetto in linguaggio Python3 richiede le seguenti librerie:</p>
<ol>
<li><code>numpy</code></li>
<li><code>cv2</code></li>
</ol>
<h2 id="esecuzione-del-progetto">Esecuzione del progetto<a class="headerlink" href="#esecuzione-del-progetto" title="Permanent link"></a></h2>
<p>Per eseguire il progetto è sufficiente eseguire lo script <code>main.py</code>, avendo cura di specificare all&rsquo;interno del file il percorso delle immagini del Sudoku da analizzare. Lo script caricherà quindi le classi dagli script secondari ed eseguirà l&rsquo;analisi stampando tutte le immagini intermedie del processo nello stesso percorso dell&rsquo;input, di modo che sia possibile osservare i vari step dell&rsquo;algoritmo.</p>
<p>Il risultato finale sarà una composizione delle 81 immagini binarie in quello che è un &ldquo;Sudoku binario&rdquo; ottimizzato per l&rsquo;analisi.</p>
<p>Di default, lo script analizza tutte le immagini contenute nella cartella <code>img</code>.</p>
<h2 id="lalgoritmo-in-breve">L&rsquo;algoritmo in breve<a class="headerlink" href="#lalgoritmo-in-breve" title="Permanent link"></a></h2>
<p>La struttura dell&rsquo;algoritmo, riassunta nei suoi punti fondamentali, è la seguente:</p>
<ol>
<li>Conversione dell&rsquo;immagine in scala di grigi, preprocessing e Thresholding.</li>
<li>Primo ritaglio approssimativo del Sudoku.</li>
<li>Ottenimento degli angoli della cornice del Sudoku.</li>
<li>Warp perspective a partire dai quattro angoli ottenuti del Sudoku.</li>
<li>Divisione dell&rsquo;immagine ottenuta in 9x9 celle di egual dimensioni.</li>
<li>Analisi della cella e ricerca di una eventuale cifra tramite ricerca del Largest Connected Component.</li>
<li>Ultimi enhancements morfologici, sogliatura degli elementi ottenuti dalle celle (per rimuovere rumori piccoli risultanti dalla ricerca del LCC).</li>
<li>Centramento dell&rsquo;eventuale cifra trovata.</li>
</ol>
<h2 id="struttura-del-codice">Struttura del codice<a class="headerlink" href="#struttura-del-codice" title="Permanent link"></a></h2>
<p>Il codice, diviso in più file e classi per poter monitorare meglio le componenti, è strutturato nel seguente modo: </p>
<ul>
<li><code>image_tools.py</code> contiene la classe omonima che fa da wrapper ulteriore a molti metodi della libreria <code>cv2</code>, in questo le altri componenti del progetto possono fare riferimento a lei e sfruttarne direttamente i metodi.</li>
<li><code>digit_extractor.py</code>, datogli una cella di un Sudoku precedentemente estratta, vi esegue sopra una ricerca del Largest Connected Component con le dovute soglie minime di luminosità. Restituisce una immagine binaria.</li>
<li><code>cell_extractor.py</code>, datogli un Sudoku ritagliato e deformato in modo da risultare quadrato, ne esegue il ritaglio in 9x9 celle e le sottopone all&rsquo;analisi di <code>digit_extractor.py</code></li>
<li><code>sudoku_extractor.py</code>, infine, è lo script principale che esegue le analisi preliminare e l&rsquo;estrazione del Sudoku in blocco, per poi sottoporlo all&rsquo;elaborazione di <code>cell_extractor.py</code></li>
</ul>
<h2 id="lalgoritmo-nel-dettaglio">L&rsquo;algoritmo nel dettaglio<a class="headerlink" href="#lalgoritmo-nel-dettaglio" title="Permanent link"></a></h2>
<p>Si analizza e si commenta ora nei dettagli l&rsquo;implementazione dell&rsquo;algoritmo nelle sue singole fasi.</p>
<p>Si riportano inoltre i frammenti di codice più significativi.</p>
<h3 id="1-preprocessing-e-thresholding">1 - Preprocessing e Thresholding<a class="headerlink" href="#1-preprocessing-e-thresholding" title="Permanent link"></a></h3>
<p>Dopo la conversione in scala di grigi dell&rsquo;immagine, si esegue un blurring gaussiano preliminare per migliorare il risultato del thresholding.</p>
<p>Successivamente, si esegue un threshold adattivo binario con valutazione locale del valore di soglia su una maschera di 25x25 pixel. Per ogni pixel viene quindi considerato come valore di soglia l&rsquo;intensità media di suddetta maschera, meno 5 punti.</p>
<p>Successivamente, per aver la certezza che il contorno del Sudoku sia continuo e chiuso, viene eseguita una operazione morfologica di closing.</p>
<div class="codehilite"><pre><span class="c1"># Da sudoku_extractor.py</span>
<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Preprocessing...&quot;</span><span class="p">)</span>
    <span class="c1"># Color Conversion and Thresholding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># Morph Close in order to close the external Square of the sudoku</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_ELLIPSE</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>        
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Fine preprocessing!&quot;</span><span class="p">)</span>

<span class="c1"># Da image_tools.py</span>
<span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c1"># We want white objects over black background</span>
    <span class="k">return</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">image</span>
</pre></div>

<h3 id="2-primo-ritaglio-approssimativo-del-sudoku">2 - Primo ritaglio approssimativo del Sudoku<a class="headerlink" href="#2-primo-ritaglio-approssimativo-del-sudoku" title="Permanent link"></a></h3>
<p>Avendo ora una immagine binaria, viene ricercato il contorno più grande presente nell&rsquo;immagine (si suppone che il Sudoku nell&rsquo;immagine di input sia l&rsquo;elemento principale dell&rsquo;immagine stessa). Per fare ciò si fa uso della funzione <code>findCountours</code> di <code>cv2</code> con opzione di ricerca nested gerarchica <code>RETR_TREE</code> e la compressione delle linee verticali, orizzontali e diagonali <code>CHAIN_APPROX_SIMPLE</code>. Dei tre output della funzione ci interesserà solo il risultante <code>contours</code> dal quale poi estrarremo il contorno di area maggiore.
Infine, viene ritagliato il Sudoku in prima via approssimativa individuando il <code>boundingRect</code> del contorno estratto. Questo ritaglio viene poi ridimensionato in forma quadrata.</p>
<div class="codehilite"><pre><span class="c1"># Da sudoku_extractor.py</span>
<span class="k">def</span> <span class="nf">crop_sudoku</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Ritagliando ora il Sudoku...&quot;</span><span class="p">)</span>
    <span class="c1"># Use image copy since findContour changes it   </span>
    <span class="n">contour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">largest_contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">sudoku</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">cut_out_sudoku_puzzle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">contour</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Fine ritaglio!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sudoku</span>

<span class="c1"># Da image_tools.py</span>
<span class="k">def</span> <span class="nf">largest_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cut_out_sudoku_puzzle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_it_square</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">make_it_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">side_length</span><span class="o">=</span><span class="mi">306</span><span class="p">):</span>
    <span class="c1"># Default is bilinear interpolation</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">side_length</span><span class="p">,</span> <span class="n">side_length</span><span class="p">))</span>
</pre></div>

<h3 id="3-4-ottenimento-dei-quattro-angoli-del-sudoku-e-warp-perspective">3, 4 - Ottenimento dei quattro angoli del Sudoku e warp perspective<a class="headerlink" href="#3-4-ottenimento-dei-quattro-angoli-del-sudoku-e-warp-perspective" title="Permanent link"></a></h3>
<p>A questo punto, si vogliono identificare i 4 angoli del Sudoku. Per fare ciò si esegue una ricerca ulteriore dei contorni con lo stesso metodo sull&rsquo;immagine parzialmente ritagliata. Successivamente, si ordinano in ordine decrescente rispetto all&rsquo;area sottesa tutti i contorni trovati.</p>
<p>Si scorrono poi i contorni trovati dal più grande al più piccolo fintanto che non viene trovato un contorno adeguatamente approssimabile ad un contorno di 4 lati. Per valutare l&rsquo;adeguatezza di una tale approssimazione, viene prima calcolato il perimetro del contorno chiuso e, successivamente, viene eseguito il metodo <code>approxPolyDP</code> che è l&rsquo;implementazione standard dell&rsquo;algoritmo Ramer–Douglas–Peucker per la semplificazione di una linea spezzata. Viene scelto un valore di $\epsilon$ molto basso (1% del perimetro), in quanto vogliamo una buona via di mezzo tra semplificazione e sensibilità a cambi netti di direzione del contorno.</p>
<p>Il primo contorno che viene approssimato dall&rsquo;algoritmo a soli 4 lati, viene selezionato come il contorno effettivo del Sudoku.</p>
<p>Si recuperano quindi i punti del contorno e li si catalogano per la successiva applicazione del metodo <code>warpPerspective</code> per ottenere l&rsquo;immagine finale del Sudoku da ritagliare in celle.</p>
<div class="codehilite"><pre><span class="c1"># Da sudoku_extractor.py</span>
<span class="k">def</span> <span class="nf">straighten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sudoku</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Raddrizzando ora l&#39;immagine...&quot;</span><span class="p">)</span>
    <span class="c1"># Use image copy since findContour changes it   </span>
    <span class="n">largest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">largest_4_side_contour</span><span class="p">(</span><span class="n">sudoku</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">largest</span><span class="p">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">get_rectangle_corners</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">sudoku</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">warp_perspective</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">sudoku</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Finito!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sudoku</span>

<span class="c1"># Da image_tools.py</span>
<span class="k">def</span> <span class="nf">largest_4_side_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
    <span class="n">contours</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">contours</span><span class="p">))]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">cnt</span><span class="p">))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cnt</span>
    <span class="k">return</span> <span class="bp">None</span>
<span class="k">def</span> <span class="nf">approx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cnt</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
    <span class="n">perimeter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">arcLength</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">approxPolyDP</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">perimeter</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>

<span class="k">def</span> <span class="nf">get_rectangle_corners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cnt</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float32&quot;</span><span class="p">)</span>

    <span class="c1"># Fun Fact: the top-left corner has the smallest coordinate sum and the bottom-rigth one the largest.</span>
    <span class="n">Sum</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">Sum</span><span class="p">)]</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">Sum</span><span class="p">)]</span>

    <span class="c1"># Fun Fact 2: the top-right corner has the minimum coordinate difference and the bottom-left one the maximum difference.</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">difference</span><span class="p">)]</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">difference</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">rect</span>

<span class="k">def</span> <span class="nf">warp_perspective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
    <span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span>
    <span class="c1"># Widths</span>
    <span class="n">widthA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">widthB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># Heights</span>
    <span class="n">heightA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">heightB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># Take Maximums</span>
    <span class="n">maxWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">widthA</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">widthB</span><span class="p">))</span>
    <span class="n">maxHeight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">heightA</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">heightB</span><span class="p">))</span>
    <span class="c1"># Construct corrispective destination points</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">maxWidth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">maxWidth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float32&quot;</span><span class="p">)</span> 
    <span class="c1"># Construct perspective matrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="n">warp</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">maxWidth</span><span class="p">,</span> <span class="n">maxHeight</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_it_square</span><span class="p">(</span><span class="n">warp</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxWidth</span><span class="p">,</span> <span class="n">maxHeight</span><span class="p">))</span>
</pre></div>

<h3 id="5-6-divisione-in-celle-ed-estrazione-del-largest-connected-component">5, 6 - Divisione in celle ed estrazione del Largest Connected Component<a class="headerlink" href="#5-6-divisione-in-celle-ed-estrazione-del-largest-connected-component" title="Permanent link"></a></h3>
<p>Dopo aver diviso il Sudoku nella sua forma finale, questo viene passato a <code>cell_extractor.py</code>, che ne esegue l&rsquo;analisi tagliandolo in 81 celle quadrate equivalenti, dalle quali viene poi estratto il Largest Connected Component tramite l&rsquo;ulteriore script <code>digit_extractor.py</code>.</p>
<p>Si esegue in via preliminare un blurring gaussiano seguito da una operazione morfologica di closing, sia per ridurre gli intralci causati dal rumore che ha passato il thresholding, sia per avere cifre più compatte.</p>
<p>Successivamente, viene eseguita la ricerca del Largest Connected Component luminoso dell&rsquo;immagine (tramite algoritmo Breadth-First Search). Per non essere intralciati dalla &ldquo;luce&rdquo; dei contorni delle celle si fanno partire i seed dell&rsquo;algoritmo di ricerca da una sottoregione centrale della cella stessa (di preciso, una regione centrata grande quanto un quarto della cella). Inoltre, si impostano due livelli diversi di sogliatura nell&rsquo;accorpamento dei pixel: si richiede una intensità uguale o superiore a 220 per i pixel di seed dell&rsquo;algoritmo ed una intensità uguale o superiore a 170 per i pixel che vengono accorpati al seed.</p>
<p>Si costruisce infine una nuova immagine binaria della cella: con i pixel del Largest Connected Component pari ad 1 e gli altri pari a 0.</p>
<div class="codehilite"><pre><span class="c1"># File digit_extractor.py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">queue</span>


<span class="k">class</span> <span class="nc">digit_extractor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &#39;digit_extractor&#39; extracts the digit from a cell.</span>
<span class="sd">    It relies on the &#39;Largest Connected Component&#39; algorithm.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">shape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_digit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">img</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>

    <span class="k">def</span> <span class="nf">build_digit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">component_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">//</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">//</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">//</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">//</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">component_id</span><span class="p">)</span>
                    <span class="n">component_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">component_sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digit</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">component_id</span><span class="p">)])</span>
        <span class="n">largest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">component_sizes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digit</span> <span class="o">==</span> <span class="n">largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">220</span><span class="p">:</span>
            <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">170</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digit</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">dj</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">di</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dj</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="n">di</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="n">dj</span><span class="p">))</span>
</pre></div>

<h3 id="7-ultimi-enhancement-morfologici-sogliatura-degli-elementi-ottenuti-dalle-celle">7 - Ultimi enhancement morfologici, sogliatura degli elementi ottenuti dalle celle<a class="headerlink" href="#7-ultimi-enhancement-morfologici-sogliatura-degli-elementi-ottenuti-dalle-celle" title="Permanent link"></a></h3>
<p>Le immagini binarie delle celle così ottenute vengono di nuovo sottoposte ad una operazione morfologica di closing per affermare la forma dell&rsquo;eventuale cifra e risolvere falle strutturali.</p>
<p>Dopodiché, siccome inevitabilmente con l&rsquo;algoritmo utilizzato sono stati ottenuti falsi positivi di piccole dimensioni, è necessario riuscire a distinguere questi dalle cifre &ldquo;vere&rdquo; che sono state estratte.</p>
<p>Per poter fare ciò si ipotizza che vi sia una differenza significativa in numero di pixel &ldquo;accesi&rdquo; tra una cifra vera ed un falso positivo. Sfruttando questa ipotesi, si applica quindi un algoritmo analogo al Basic Global Thresholding, eseguendone 7 iterazioni sul vettore contenente i numeri di pixel accesi nelle 81 celle. Le celle selezionate vengono lasciate inalterate, le celle non selezionate vengono totalmente oscurate.</p>
<p>In questo modo non si forniscono dati spazzatura alla futura fase di riconoscimento delle cifre.</p>
<div class="codehilite"><pre><span class="c1"># Da cell_extractor.py</span>
<span class="k">def</span> <span class="nf">final_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cells</span><span class="p">):</span>
    <span class="c1"># Count points</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">))[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="c1"># Try this basic threshold</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">/</span> <span class="mi">81</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
        <span class="n">mean1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">points</span><span class="p">[(</span><span class="n">points</span> <span class="o">&gt;</span> <span class="n">mean</span><span class="p">)])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">points</span><span class="p">[(</span><span class="n">points</span> <span class="o">&gt;</span> <span class="n">mean</span><span class="p">)])</span>
        <span class="n">mean2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">points</span><span class="p">[(</span><span class="n">points</span> <span class="o">&lt;</span> <span class="n">mean</span><span class="p">)])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">points</span><span class="p">[(</span><span class="n">points</span> <span class="o">&lt;</span> <span class="n">mean</span><span class="p">)])</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean1</span> <span class="o">+</span> <span class="n">mean2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Now obscure the unworthy ones!</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">9</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mean</span><span class="p">:</span>
                <span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cells</span>
</pre></div>

<h3 id="8-centramento-delleventuale-cifra-nella-cella">8 - Centramento dell&rsquo;eventuale cifra nella cella<a class="headerlink" href="#8-centramento-delleventuale-cifra-nella-cella" title="Permanent link"></a></h3>
<p>Se presente una cifra in una cella, questa viene centrata considerandone il rettangolo minimo parallelo agli assi che la contiene. Tale rettangolo viene poi traslato per essere collocato al centro della cella.</p>
<p>Tale procedimento viene eseguito separatamente per i due assi dell&rsquo;immagine.</p>
<p>A questo punto, avendo le cifre centrate, è possibile combinare le celle ottenute per formare l&rsquo;immagine di Sudoku Binario ottimizzato, in modo da poter verificare la corretta esecuzione dell&rsquo;algoritmo.</p>
<div class="codehilite"><pre><span class="c1"># Da cell_extractor.py</span>
<span class="k">def</span> <span class="nf">center_digit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digit</span><span class="p">):</span>
    <span class="n">digit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_x</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="n">digit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_y</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">digit</span>

<span class="k">def</span> <span class="nf">center_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digit</span><span class="p">):</span>
    <span class="n">top_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">get_top_line</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="n">bottom_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">get_bottom_line</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">top_line</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">bottom_line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">digit</span>
    <span class="n">length_2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">top_line</span> <span class="o">-</span> <span class="n">bottom_line</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">corr_pos</span> <span class="o">=</span> <span class="n">digit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">length_2</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">corr_pos</span> <span class="o">-</span> <span class="n">top_line</span>

    <span class="n">digit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">row_shift</span><span class="p">(</span><span class="n">digit</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">top_line</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">bottom_line</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">digit</span>

<span class="k">def</span> <span class="nf">center_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digit</span><span class="p">):</span>
    <span class="n">left_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">get_left_line</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="n">right_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">get_right_line</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">left_line</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">right_line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">digit</span>
    <span class="n">length_2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left_line</span> <span class="o">-</span> <span class="n">right_line</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">corr_pos</span> <span class="o">=</span> <span class="n">digit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">length_2</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">corr_pos</span> <span class="o">-</span> <span class="n">left_line</span>

    <span class="n">digit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">col_shift</span><span class="p">(</span><span class="n">digit</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">left_line</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">right_line</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">digit</span>

<span class="c1"># Da image_tools.py</span>
<span class="k">def</span> <span class="nf">get_top_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">get_bottom_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">get_left_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">get_right_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">row_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the starting row and the ending row,</span>
<span class="sd">    it shifts them by a given number of steps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">-</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">+</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="n">shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">shifted</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">shifted</span>

<span class="k">def</span> <span class="nf">col_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the starting column and the ending column,</span>
<span class="sd">    it shifts them by a given number of steps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">-</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">+</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="n">shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">shifted</span><span class="p">[:,</span> <span class="n">col</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">shifted</span>
</pre></div>

<h2 id="esempi-di-input-e-risultati">Esempi di input e risultati<a class="headerlink" href="#esempi-di-input-e-risultati" title="Permanent link"></a></h2>
<p>Si presentano ora alcune immagini input di esempio, i risultati delle fasi di elaborazione intermedie e l&rsquo;output finale in forma di &ldquo;Sudoku Binario&rdquo; elaborato le cui celle potranno poi essere interpretate facilmente dal sistema di riconoscimento di cifre. </p>
<h3 id="input-esempio-ed-elaborazioni-intermedie">Input esempio ed elaborazioni intermedie<a class="headerlink" href="#input-esempio-ed-elaborazioni-intermedie" title="Permanent link"></a></h3>
<h4 id="esempio-1">Esempio 1<a class="headerlink" href="#esempio-1" title="Permanent link"></a></h4>
<p>Si parte con la seguente foto di un Sudoku:
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/test2.jpg" />
Si eseguono poi i primi step di preprocessing e di ritaglio.</p>
<table>
<thead>
<tr>
<th align="center">Dopo preprocessing</th>
<th align="center">Dopo primo ritaglio parziale</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/pre.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/fir_cut.png" /></td>
</tr>
</tbody>
</table>
<p>Si ottiene infine con il warping prospettico il Sudoku ritagliato.
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/fin_cut.png" />
Da questo Sudoku vengono estratte ed elaborate singolarmente le 81 celle che lo costituiscono. Si mostra a titolo di esempio l&rsquo;elaborazione della cella (4,6)</p>
<table>
<thead>
<tr>
<th align="center">Dopo ritaglio</th>
<th align="center">Dopo pulizia</th>
<th align="center">Dopo estrazione</th>
<th align="center">Dopo centramento</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/46_1.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/46_2.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/46_3.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/46_4.png" /></td>
</tr>
</tbody>
</table>
<p>e della cella (6,2)</p>
<table>
<thead>
<tr>
<th align="center">Dopo ritaglio</th>
<th align="center">Dopo pulizia</th>
<th align="center">Dopo estrazione</th>
<th align="center">Dopo centramento</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/62_1.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/62_2.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/62_3.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/62_4.png" /></td>
</tr>
</tbody>
</table>
<p>Un esempio di &ldquo;falso positivo&rdquo;, che viene poi rimosso con l&rsquo;operazione di basic thresholding, è il caso della cella (5,5)</p>
<table>
<thead>
<tr>
<th align="center">Dopo ritaglio</th>
<th align="center">Dopo pulizia</th>
<th align="center">Dopo estrazione</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/55_1.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/55_2.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/55_3.png" /></td>
</tr>
</tbody>
</table>
<p>Combinando i risultati di tutte e 81 le celle, si ottiene l&rsquo;immagine binaria finale ripulita del Sudoku:
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/2/binary.png" /></p>
<h4 id="esempio-2">Esempio 2<a class="headerlink" href="#esempio-2" title="Permanent link"></a></h4>
<p>Si parte con la seguente foto di un Sudoku:
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/image8.jpg" />
Si eseguono poi i primi step di preprocessing e di ritaglio.</p>
<table>
<thead>
<tr>
<th align="center">Dopo preprocessing</th>
<th align="center">Dopo primo ritaglio parziale</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/pre.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/fir_cut.png" /></td>
</tr>
</tbody>
</table>
<p>Si ottiene infine con il warping prospettico il Sudoku ritagliato.
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/fin_cut.png" />
Da questo Sudoku vengono estratte ed elaborate singolarmente le 81 celle che lo costituiscono. Si mostra a titolo di esempio l&rsquo;elaborazione della cella (8,0)</p>
<table>
<thead>
<tr>
<th align="center">Dopo ritaglio</th>
<th align="center">Dopo pulizia</th>
<th align="center">Dopo estrazione</th>
<th align="center">Dopo centramento</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/80_1.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/80_2.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/80_3.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/80_4.png" /></td>
</tr>
</tbody>
</table>
<p>e della cella (8,3)</p>
<table>
<thead>
<tr>
<th align="center">Dopo ritaglio</th>
<th align="center">Dopo pulizia</th>
<th align="center">Dopo estrazione</th>
<th align="center">Dopo centramento</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/83_1.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/83_2.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/83_3.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/83_4.png" /></td>
</tr>
</tbody>
</table>
<p>Un esempio di &ldquo;falso positivo&rdquo;, che viene poi rimosso con l&rsquo;operazione di basic thresholding, è il caso della cella (5,3)</p>
<table>
<thead>
<tr>
<th align="center">Dopo ritaglio</th>
<th align="center">Dopo pulizia</th>
<th align="center">Dopo estrazione</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/53_1.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/53_2.png" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/53_3.png" /></td>
</tr>
</tbody>
</table>
<p>Combinando i risultati di tutte e 81 le celle, si ottiene l&rsquo;immagine binaria finale ripulita del Sudoku:
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/1/binary.png" /></p>
<p>Notare come il metodo risulti ancora sufficientemente valido nonostante la scarsa risoluzione dell&rsquo;immagine di partenza.</p>
<h3 id="altri-risultati">Altri risultati<a class="headerlink" href="#altri-risultati" title="Permanent link"></a></h3>
<p>Si riportano altri esempi in cui l&rsquo;algoritmo è risultato perfettamente funzionante.</p>
<table>
<thead>
<tr>
<th align="center">Immagine di partenza</th>
<th align="center">Immagine binaria finale</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image1.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin1.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image2.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin2.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image3.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin3.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image4.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin4.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image5.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin5.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image6.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin6.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image7.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin7.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image8.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin8.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image10.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin10.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image11.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin11.png" /></td>
</tr>
<tr>
<td align="center">:------------------:</td>
<td align="center">:---------------------:</td>
</tr>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/image12.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/bin12.png" /></td>
</tr>
</tbody>
</table>
<h3 id="risultati-fallimentari-cause-e-possibili-miglioramenti">Risultati fallimentari (cause e possibili miglioramenti)<a class="headerlink" href="#risultati-fallimentari-cause-e-possibili-miglioramenti" title="Permanent link"></a></h3>
<h4 id="caso-1-risoluzione-scarsa-e-immagine-sporca">Caso 1: risoluzione scarsa e immagine sporca<a class="headerlink" href="#caso-1-risoluzione-scarsa-e-immagine-sporca" title="Permanent link"></a></h4>
<table>
<thead>
<tr>
<th align="center">Immagine</th>
<th align="center">Risultato finale</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/failures/image9.jpg" /></td>
<td align="center"><img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/failures/bin9.png" /></td>
</tr>
</tbody>
</table>
<p>A causa della scarsa risoluzione dell&rsquo;immagine e della presenza di macchie in prossimità di alcuni numeri (precisamente, nella cella (1,8)), la resa binaria finale delle cifre risulta in certi casi compromessa ad un livello che rischia di intralciare significativamente la successiva analisi di riconoscimento.</p>
<p>In questo caso, una possibile soluzione potrebbe essere l&rsquo;applicazione delle operazioni preliminari di thresholding non sulla sola scala di grigi dell&rsquo;immagine ma sui canali di colore separati, dimodo che si riescano a distinguere meglio gli elementi di colore nero dagli artefatti di colore diverso.</p>
<h4 id="caso-2-immagine-sfocata">Caso 2: Immagine sfocata<a class="headerlink" href="#caso-2-immagine-sfocata" title="Permanent link"></a></h4>
<p>La seguente immagine
<img alt="" src="///C://Users/carli/Desktop/Progetto_Analisi_Immagini_Montanari/sel_img/failures/fail1.jpg" />
risulta impossibile da processare con l&rsquo;algoritmo nella sua forma attuale in quanto la sfocatura consistente in basso a destra della cornice del sudoku causa problemi consistenti all&rsquo;algoritmo di individuazione dei contorni.</p>
<p>Una possibile soluzione è operare sull&rsquo;immagine un consistente enhancement ad-hoc per migliorare la qualità della cornice e risolvere i difetti consistenti causati dalla sfocatura.</p></article></body></html>